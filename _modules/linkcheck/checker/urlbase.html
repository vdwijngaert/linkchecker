

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>linkcheck.checker.urlbase &mdash; LinkChecker 2021-08-09 documentation</title>
  

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/graphviz.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> LinkChecker
          

          
            
            <img src="../../../_static/logo128x128.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                2021-08-09
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
    
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../install.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../install.html#setup-with-pip">Setup with pip</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../install.html#setup-for-windows">Setup for Windows</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../install.html#setup-for-macos">Setup for macOS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../install.html#setup-for-gnu-linux">Setup for GNU/Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../install.html#manual-setup-for-unix-systems">Manual setup for Unix systems</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../install.html#after-installation">After installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../install.html#wsgi-web-interface">WSGI web interface</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../upgrading.html">Upgrading</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../upgrading.html#migrating-from-9-x-to-10-0">Migrating from 9.x to 10.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../upgrading.html#migrating-from-8-x-to-9-0">Migrating from 8.x to 9.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../upgrading.html#migrating-from-8-4-to-8-5">Migrating from 8.4 to 8.5</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../upgrading.html#migrating-from-8-0-to-8-1">Migrating from 8.0 to 8.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../upgrading.html#migrating-from-7-9-to-8-0">Migrating from 7.9 to 8.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../upgrading.html#migrating-from-7-6-to-7-7">Migrating from 7.6 to 7.7</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../upgrading.html#migrating-from-7-3-to-7-4">Migrating from 7.3 to 7.4</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../upgrading.html#migrating-from-7-0-to-7-1">Migrating from 7.0 to 7.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../upgrading.html#migrating-from-6-x-to-7-0">Migrating from 6.x to 7.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../upgrading.html#migrating-from-6-6-to-6-7">Migrating from 6.6 to 6.7</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../upgrading.html#migrating-from-6-4-to-6-5">Migrating from 6.4 to 6.5</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../upgrading.html#migrating-from-5-5-to-6-0">Migrating from 5.5 to 6.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../upgrading.html#migrating-from-5-2-to-5-3">Migrating from 5.2 to 5.3</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../upgrading.html#migrating-from-5-1-to-5-2">Migrating from 5.1 to 5.2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../upgrading.html#migrating-from-5-0-to-5-1">Migrating from 5.0 to 5.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../upgrading.html#migrating-from-4-x-to-5-0">Migrating from 4.x to 5.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../upgrading.html#migrating-from-4-4-to-4-5">Migrating from 4.4 to 4.5</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../upgrading.html#migrating-from-4-2-to-4-3">Migrating from 4.2 to 4.3</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../upgrading.html#migrating-from-4-1-to-4-2">Migrating from 4.1 to 4.2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../upgrading.html#migrating-from-3-x-to-4-0">Migrating from 3.x to 4.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../upgrading.html#migrating-from-3-0-to-3-1">Migrating from 3.0 to 3.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../upgrading.html#migrating-from-2-x-to-3-0">Migrating from 2.x to 3.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../upgrading.html#migrating-from-2-2-to-2-3">Migrating from 2.2 to 2.3</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../upgrading.html#migrating-from-1-x-to-2-0">Migrating from 1.x to 2.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../upgrading.html#migrating-from-1-12-x-to-1-13-0">Migrating from 1.12.x to 1.13.0</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../man/linkchecker.html">linkchecker</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../man/linkchecker.html#synopsis">SYNOPSIS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../man/linkchecker.html#description">DESCRIPTION</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../man/linkchecker.html#examples">EXAMPLES</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../man/linkchecker.html#options">OPTIONS</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../man/linkchecker.html#general-options">General options</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../man/linkchecker.html#output-options">Output options</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../man/linkchecker.html#checking-options">Checking options</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../man/linkchecker.html#configuration-files">CONFIGURATION FILES</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../man/linkchecker.html#output-types">OUTPUT TYPES</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../man/linkchecker.html#regular-expressions">REGULAR EXPRESSIONS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../man/linkchecker.html#cookie-files">COOKIE FILES</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../man/linkchecker.html#proxy-support">PROXY SUPPORT</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../man/linkchecker.html#performed-checks">PERFORMED CHECKS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../man/linkchecker.html#plugins">PLUGINS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../man/linkchecker.html#recursion">RECURSION</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../man/linkchecker.html#notes">NOTES</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../man/linkchecker.html#environment">ENVIRONMENT</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../man/linkchecker.html#return-value">RETURN VALUE</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../man/linkchecker.html#limitations">LIMITATIONS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../man/linkchecker.html#files">FILES</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../man/linkchecker.html#see-also">SEE ALSO</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../man/linkcheckerrc.html">linkcheckerrc</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../man/linkcheckerrc.html#description">DESCRIPTION</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../man/linkcheckerrc.html#settings">SETTINGS</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../man/linkcheckerrc.html#checking">checking</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../man/linkcheckerrc.html#filtering">filtering</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../man/linkcheckerrc.html#authentication">authentication</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../man/linkcheckerrc.html#output">output</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../man/linkcheckerrc.html#text">text</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../man/linkcheckerrc.html#gml">gml</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../man/linkcheckerrc.html#dot">dot</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../man/linkcheckerrc.html#csv">csv</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../man/linkcheckerrc.html#sql">sql</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../man/linkcheckerrc.html#html">html</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../man/linkcheckerrc.html#failures">failures</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../man/linkcheckerrc.html#xml">xml</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../man/linkcheckerrc.html#gxml">gxml</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../man/linkcheckerrc.html#sitemap">sitemap</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../man/linkcheckerrc.html#logger-parts">LOGGER PARTS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../man/linkcheckerrc.html#multiline">MULTILINE</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../man/linkcheckerrc.html#example">EXAMPLE</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../man/linkcheckerrc.html#plugins">PLUGINS</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../man/linkcheckerrc.html#anchorcheck">AnchorCheck</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../man/linkcheckerrc.html#locationinfo">LocationInfo</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../man/linkcheckerrc.html#regexcheck">RegexCheck</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../man/linkcheckerrc.html#sslcertificatecheck">SslCertificateCheck</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../man/linkcheckerrc.html#htmlsyntaxcheck">HtmlSyntaxCheck</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../man/linkcheckerrc.html#httpheaderinfo">HttpHeaderInfo</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../man/linkcheckerrc.html#csssyntaxcheck">CssSyntaxCheck</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../man/linkcheckerrc.html#viruscheck">VirusCheck</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../man/linkcheckerrc.html#pdfparser">PdfParser</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../man/linkcheckerrc.html#wordparser">WordParser</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../man/linkcheckerrc.html#markdowncheck">MarkdownCheck</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../man/linkcheckerrc.html#warnings">WARNINGS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../man/linkcheckerrc.html#see-also">SEE ALSO</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing.html">Contribution Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../contributing.html#positive-feedback">Positive feedback</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../contributing.html#issues-and-bug-reports">Issues and bug reports</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../contributing.html#issue-triage">Issue triage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../contributing.html#security-issues">Security issues</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../contributing.html#patches">Patches</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../contributing.html#patch-triage">Patch triage</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../contributing.html#membership">Membership</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../code_of_conduct.html">Contributor Covenant Code of Conduct</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../code_of_conduct.html#our-pledge">Our Pledge</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../code_of_conduct.html#our-standards">Our Standards</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../code_of_conduct.html#our-responsibilities">Our Responsibilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../code_of_conduct.html#scope">Scope</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../code_of_conduct.html#enforcement">Enforcement</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../code_of_conduct.html#contacts">Contacts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../code_of_conduct.html#attribution">Attribution</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../code_of_conduct.html#changes">Changes</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../code/index.html">Code</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../code/linkcheck/linkcheck.html">linkcheck</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../code/linkcheck/linkcheck.ansicolor.html">linkcheck.ansicolor</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../code/linkcheck/linkcheck.better_exchook2.html">linkcheck.better_exchook2</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../code/linkcheck/linkcheck.bookmarks.html">linkcheck.bookmarks</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../code/linkcheck/linkcheck.bookmarks.chromium.html">linkcheck.bookmarks.chromium</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../code/linkcheck/linkcheck.bookmarks.firefox.html">linkcheck.bookmarks.firefox</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../code/linkcheck/linkcheck.bookmarks.opera.html">linkcheck.bookmarks.opera</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../code/linkcheck/linkcheck.bookmarks.safari.html">linkcheck.bookmarks.safari</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../code/linkcheck/linkcheck.cache.html">linkcheck.cache</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../code/linkcheck/linkcheck.cache.results.html">linkcheck.cache.results</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../code/linkcheck/linkcheck.cache.robots_txt.html">linkcheck.cache.robots_txt</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../code/linkcheck/linkcheck.cache.urlqueue.html">linkcheck.cache.urlqueue</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../code/linkcheck/linkcheck.checker.html">linkcheck.checker</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../code/linkcheck/linkcheck.checker.const.html">linkcheck.checker.const</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../code/linkcheck/linkcheck.checker.dnsurl.html">linkcheck.checker.dnsurl</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../code/linkcheck/linkcheck.checker.fileurl.html">linkcheck.checker.fileurl</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../code/linkcheck/linkcheck.checker.ftpurl.html">linkcheck.checker.ftpurl</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../code/linkcheck/linkcheck.checker.httpurl.html">linkcheck.checker.httpurl</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../code/linkcheck/linkcheck.checker.ignoreurl.html">linkcheck.checker.ignoreurl</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../code/linkcheck/linkcheck.checker.internpaturl.html">linkcheck.checker.internpaturl</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../code/linkcheck/linkcheck.checker.itmsservicesurl.html">linkcheck.checker.itmsservicesurl</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../code/linkcheck/linkcheck.checker.mailtourl.html">linkcheck.checker.mailtourl</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../code/linkcheck/linkcheck.checker.nntpurl.html">linkcheck.checker.nntpurl</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../code/linkcheck/linkcheck.checker.proxysupport.html">linkcheck.checker.proxysupport</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../code/linkcheck/linkcheck.checker.telneturl.html">linkcheck.checker.telneturl</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../code/linkcheck/linkcheck.checker.unknownurl.html">linkcheck.checker.unknownurl</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../code/linkcheck/linkcheck.checker.urlbase.html">linkcheck.checker.urlbase</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../code/linkcheck/linkcheck.cmdline.html">linkcheck.cmdline</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../code/linkcheck/linkcheck.configuration.html">linkcheck.configuration</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../code/linkcheck/linkcheck.configuration.confparse.html">linkcheck.configuration.confparse</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../code/linkcheck/linkcheck.containers.html">linkcheck.containers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../code/linkcheck/linkcheck.cookies.html">linkcheck.cookies</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../code/linkcheck/linkcheck.decorators.html">linkcheck.decorators</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../code/linkcheck/linkcheck.director.html">linkcheck.director</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../code/linkcheck/linkcheck.director.aggregator.html">linkcheck.director.aggregator</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../code/linkcheck/linkcheck.director.checker.html">linkcheck.director.checker</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../code/linkcheck/linkcheck.director.console.html">linkcheck.director.console</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../code/linkcheck/linkcheck.director.interrupter.html">linkcheck.director.interrupter</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../code/linkcheck/linkcheck.director.logger.html">linkcheck.director.logger</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../code/linkcheck/linkcheck.director.status.html">linkcheck.director.status</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../code/linkcheck/linkcheck.director.task.html">linkcheck.director.task</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../code/linkcheck/linkcheck.dummy.html">linkcheck.dummy</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../code/linkcheck/linkcheck.fileutil.html">linkcheck.fileutil</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../code/linkcheck/linkcheck.ftpparse.html">linkcheck.ftpparse</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../code/linkcheck/linkcheck.htmlutil.html">linkcheck.htmlutil</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../code/linkcheck/linkcheck.htmlutil.htmlsoup.html">linkcheck.htmlutil.htmlsoup</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../code/linkcheck/linkcheck.htmlutil.linkparse.html">linkcheck.htmlutil.linkparse</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../code/linkcheck/linkcheck.htmlutil.loginformsearch.html">linkcheck.htmlutil.loginformsearch</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../code/linkcheck/linkcheck.httputil.html">linkcheck.httputil</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../code/linkcheck/linkcheck.i18n.html">linkcheck.i18n</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../code/linkcheck/linkcheck.lc_cgi.html">linkcheck.lc_cgi</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../code/linkcheck/linkcheck.loader.html">linkcheck.loader</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../code/linkcheck/linkcheck.lock.html">linkcheck.lock</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../code/linkcheck/linkcheck.log.html">linkcheck.log</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../code/linkcheck/linkcheck.logconf.html">linkcheck.logconf</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../code/linkcheck/linkcheck.logger.html">linkcheck.logger</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../code/linkcheck/linkcheck.logger.csvlog.html">linkcheck.logger.csvlog</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../code/linkcheck/linkcheck.logger.customxml.html">linkcheck.logger.customxml</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../code/linkcheck/linkcheck.logger.dot.html">linkcheck.logger.dot</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../code/linkcheck/linkcheck.logger.failures.html">linkcheck.logger.failures</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../code/linkcheck/linkcheck.logger.gml.html">linkcheck.logger.gml</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../code/linkcheck/linkcheck.logger.graph.html">linkcheck.logger.graph</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../code/linkcheck/linkcheck.logger.gxml.html">linkcheck.logger.gxml</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../code/linkcheck/linkcheck.logger.html.html">linkcheck.logger.html</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../code/linkcheck/linkcheck.logger.none.html">linkcheck.logger.none</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../code/linkcheck/linkcheck.logger.sitemapxml.html">linkcheck.logger.sitemapxml</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../code/linkcheck/linkcheck.logger.sql.html">linkcheck.logger.sql</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../code/linkcheck/linkcheck.logger.text.html">linkcheck.logger.text</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../code/linkcheck/linkcheck.logger.xmllog.html">linkcheck.logger.xmllog</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../code/linkcheck/linkcheck.memoryutil.html">linkcheck.memoryutil</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../code/linkcheck/linkcheck.mimeutil.html">linkcheck.mimeutil</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../code/linkcheck/linkcheck.network.html">linkcheck.network</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../code/linkcheck/linkcheck.network.iputil.html">linkcheck.network.iputil</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../code/linkcheck/linkcheck.parser.html">linkcheck.parser</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../code/linkcheck/linkcheck.parser.sitemap.html">linkcheck.parser.sitemap</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../code/linkcheck/linkcheck.plugins.html">linkcheck.plugins</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../code/linkcheck/linkcheck.plugins.anchorcheck.html">linkcheck.plugins.anchorcheck</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../code/linkcheck/linkcheck.plugins.httpheaderinfo.html">linkcheck.plugins.httpheaderinfo</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../code/linkcheck/linkcheck.plugins.locationinfo.html">linkcheck.plugins.locationinfo</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../code/linkcheck/linkcheck.plugins.markdowncheck.html">linkcheck.plugins.markdowncheck</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../code/linkcheck/linkcheck.plugins.parsepdf.html">linkcheck.plugins.parsepdf</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../code/linkcheck/linkcheck.plugins.parseword.html">linkcheck.plugins.parseword</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../code/linkcheck/linkcheck.plugins.regexcheck.html">linkcheck.plugins.regexcheck</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../code/linkcheck/linkcheck.plugins.sslcertcheck.html">linkcheck.plugins.sslcertcheck</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../code/linkcheck/linkcheck.plugins.syntaxchecks.html">linkcheck.plugins.syntaxchecks</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../code/linkcheck/linkcheck.plugins.viruscheck.html">linkcheck.plugins.viruscheck</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../code/linkcheck/linkcheck.robotparser2.html">linkcheck.robotparser2</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../code/linkcheck/linkcheck.socketutil.html">linkcheck.socketutil</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../code/linkcheck/linkcheck.strformat.html">linkcheck.strformat</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../code/linkcheck/linkcheck.threader.html">linkcheck.threader</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../code/linkcheck/linkcheck.trace.html">linkcheck.trace</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../code/linkcheck/linkcheck.url.html">linkcheck.url</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
    <a href="../../../genindex.html">Index</a>
    <hr>
    <a href="https://github.com/linkchecker/linkchecker/blob/master/doc/changelog.txt">Change Log</a>
    <a href="https://github.com/linkchecker/linkchecker/issues/">Issue Tracker</a>
  
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">LinkChecker</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
          <li><a href="../../linkcheck.html">linkcheck</a> &raquo;</li>
        
          <li><a href="../checker.html">linkcheck.checker</a> &raquo;</li>
        
      <li>linkcheck.checker.urlbase</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for linkcheck.checker.urlbase</h1><div class="highlight"><pre>
<span></span><span class="c1"># Copyright (C) 2000-2014 Bastian Kleineidam</span>
<span class="c1">#</span>
<span class="c1"># This program is free software; you can redistribute it and/or modify</span>
<span class="c1"># it under the terms of the GNU General Public License as published by</span>
<span class="c1"># the Free Software Foundation; either version 2 of the License, or</span>
<span class="c1"># (at your option) any later version.</span>
<span class="c1">#</span>
<span class="c1"># This program is distributed in the hope that it will be useful,</span>
<span class="c1"># but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c1"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="c1"># GNU General Public License for more details.</span>
<span class="c1">#</span>
<span class="c1"># You should have received a copy of the GNU General Public License along</span>
<span class="c1"># with this program; if not, write to the Free Software Foundation, Inc.,</span>
<span class="c1"># 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Base URL handler.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">urllib.parse</span>
<span class="kn">from</span> <span class="nn">urllib.request</span> <span class="kn">import</span> <span class="n">urlopen</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">errno</span>
<span class="kn">import</span> <span class="nn">socket</span>
<span class="kn">import</span> <span class="nn">select</span>
<span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">BytesIO</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">absolute_url</span><span class="p">,</span> <span class="n">get_url_from</span>
<span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">log</span><span class="p">,</span>
    <span class="n">LOG_CHECK</span><span class="p">,</span>
    <span class="n">strformat</span><span class="p">,</span>
    <span class="n">LinkCheckerError</span><span class="p">,</span>
    <span class="n">url</span> <span class="k">as</span> <span class="n">urlutil</span><span class="p">,</span>
    <span class="n">trace</span><span class="p">,</span>
    <span class="n">get_link_pat</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">..htmlutil</span> <span class="kn">import</span> <span class="n">htmlsoup</span>
<span class="kn">from</span> <span class="nn">..network</span> <span class="kn">import</span> <span class="n">iputil</span>
<span class="kn">from</span> <span class="nn">.const</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">WARN_URL_EFFECTIVE_URL</span><span class="p">,</span>
    <span class="n">WARN_URL_ERROR_GETTING_CONTENT</span><span class="p">,</span>
    <span class="n">WARN_URL_OBFUSCATED_IP</span><span class="p">,</span>
    <span class="n">WARN_URL_CONTENT_SIZE_ZERO</span><span class="p">,</span>
    <span class="n">WARN_URL_CONTENT_SIZE_TOO_LARGE</span><span class="p">,</span>
    <span class="n">WARN_URL_WHITESPACE</span><span class="p">,</span>
    <span class="n">URL_MAX_LENGTH</span><span class="p">,</span>
    <span class="n">WARN_URL_TOO_LONG</span><span class="p">,</span>
    <span class="n">ExcList</span><span class="p">,</span>
    <span class="n">ExcSyntaxList</span><span class="p">,</span>
    <span class="n">ExcNoCacheList</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">..url</span> <span class="kn">import</span> <span class="n">url_fix_wayback_query</span>

<span class="c1"># schemes that are invalid with an empty hostname</span>
<span class="n">scheme_requires_host</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;ftp&quot;</span><span class="p">,</span> <span class="s2">&quot;http&quot;</span><span class="p">,</span> <span class="s2">&quot;telnet&quot;</span><span class="p">)</span>


<div class="viewcode-block" id="urljoin"><a class="viewcode-back" href="../../../code/linkcheck/linkcheck.checker.urlbase.html#linkcheck.checker.urlbase.urljoin">[docs]</a><span class="k">def</span> <span class="nf">urljoin</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    If url is relative, join parent and url. Else leave url as-is.</span>

<span class="sd">    @return: joined url</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">urlutil</span><span class="o">.</span><span class="n">url_is_absolute</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">url</span>
    <span class="k">return</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">urljoin</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span></div>


<div class="viewcode-block" id="url_norm"><a class="viewcode-back" href="../../../code/linkcheck/linkcheck.checker.urlbase.html#linkcheck.checker.urlbase.url_norm">[docs]</a><span class="k">def</span> <span class="nf">url_norm</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">encoding</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Wrapper for url.url_norm() to convert UnicodeError in</span>
<span class="sd">    LinkCheckerError.&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">urlutil</span><span class="o">.</span><span class="n">url_norm</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">UnicodeError</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;URL has unparsable domain name: </span><span class="si">%(name)s</span><span class="s2">&quot;</span><span class="p">)</span> <span class="o">%</span> <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
        <span class="p">}</span>
        <span class="k">raise</span> <span class="n">LinkCheckerError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span></div>


<div class="viewcode-block" id="UrlBase"><a class="viewcode-back" href="../../../code/linkcheck/linkcheck.checker.urlbase.html#linkcheck.checker.urlbase.UrlBase">[docs]</a><span class="k">class</span> <span class="nc">UrlBase</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;An URL with additional information like validity etc.&quot;&quot;&quot;</span>

    <span class="c1"># file types that can be parsed recursively</span>
    <span class="n">ContentMimetypes</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;text/html&quot;</span><span class="p">:</span> <span class="s2">&quot;html&quot;</span><span class="p">,</span>
        <span class="s2">&quot;application/xhtml+xml&quot;</span><span class="p">:</span> <span class="s2">&quot;html&quot;</span><span class="p">,</span>
        <span class="c1"># Include PHP file which helps when checking local .php files.</span>
        <span class="c1"># It does not harm other URL schemes like HTTP since HTTP servers</span>
        <span class="c1"># should not send this content type. They send text/html instead.</span>
        <span class="s2">&quot;application/x-httpd-php&quot;</span><span class="p">:</span> <span class="s2">&quot;html&quot;</span><span class="p">,</span>
        <span class="s2">&quot;text/css&quot;</span><span class="p">:</span> <span class="s2">&quot;css&quot;</span><span class="p">,</span>
        <span class="s2">&quot;application/x-shockwave-flash&quot;</span><span class="p">:</span> <span class="s2">&quot;swf&quot;</span><span class="p">,</span>
        <span class="s2">&quot;application/msword&quot;</span><span class="p">:</span> <span class="s2">&quot;word&quot;</span><span class="p">,</span>
        <span class="s2">&quot;text/plain+linkchecker&quot;</span><span class="p">:</span> <span class="s2">&quot;text&quot;</span><span class="p">,</span>
        <span class="s2">&quot;text/plain+opera&quot;</span><span class="p">:</span> <span class="s2">&quot;opera&quot;</span><span class="p">,</span>
        <span class="s2">&quot;text/plain+chromium&quot;</span><span class="p">:</span> <span class="s2">&quot;chromium&quot;</span><span class="p">,</span>
        <span class="s2">&quot;application/x-plist+safari&quot;</span><span class="p">:</span> <span class="s2">&quot;safari&quot;</span><span class="p">,</span>
        <span class="s2">&quot;text/vnd.wap.wml&quot;</span><span class="p">:</span> <span class="s2">&quot;wml&quot;</span><span class="p">,</span>
        <span class="s2">&quot;application/xml+sitemap&quot;</span><span class="p">:</span> <span class="s2">&quot;sitemap&quot;</span><span class="p">,</span>
        <span class="s2">&quot;application/xml+sitemapindex&quot;</span><span class="p">:</span> <span class="s2">&quot;sitemapindex&quot;</span><span class="p">,</span>
        <span class="s2">&quot;application/pdf&quot;</span><span class="p">:</span> <span class="s2">&quot;pdf&quot;</span><span class="p">,</span>
        <span class="s2">&quot;application/x-pdf&quot;</span><span class="p">:</span> <span class="s2">&quot;pdf&quot;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="c1"># Read in 16kb chunks</span>
    <span class="n">ReadChunkBytes</span> <span class="o">=</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">16</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">base_url</span><span class="p">,</span>
        <span class="n">recursion_level</span><span class="p">,</span>
        <span class="n">aggregate</span><span class="p">,</span>
        <span class="n">parent_url</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">base_ref</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">line</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">column</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">page</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">url_encoding</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">extern</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize check data, and store given variables.</span>

<span class="sd">        @param base_url: unquoted and possibly unnormed url</span>
<span class="sd">        @param recursion_level: on what check level lies the base url</span>
<span class="sd">        @param aggregate: aggregate instance</span>
<span class="sd">        @param parent_url: quoted and normed url of parent or None</span>
<span class="sd">        @param base_ref: quoted and normed url of &lt;base href=&quot;&quot;&gt; or None</span>
<span class="sd">        @param line: line number of url in parent content</span>
<span class="sd">        @param column: column number of url in parent content</span>
<span class="sd">        @param page: page number of url in parent content</span>
<span class="sd">        @param name: name of url or empty</span>
<span class="sd">        @param url_encoding: encoding of URL or None</span>
<span class="sd">        @param extern: None or (is_extern, is_strict)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="p">(</span>
            <span class="n">base_ref</span><span class="p">,</span>
            <span class="n">base_url</span><span class="p">,</span>
            <span class="n">parent_url</span><span class="p">,</span>
            <span class="n">recursion_level</span><span class="p">,</span>
            <span class="n">aggregate</span><span class="p">,</span>
            <span class="n">line</span><span class="p">,</span>
            <span class="n">column</span><span class="p">,</span>
            <span class="n">page</span><span class="p">,</span>
            <span class="n">name</span><span class="p">,</span>
            <span class="n">url_encoding</span><span class="p">,</span>
            <span class="n">extern</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_syntax</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">recursion_level</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_intern_pattern</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_extern</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">extern</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">extern</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_info</span><span class="p">(</span>
                <span class="n">_</span><span class="p">(</span><span class="s2">&quot;The URL is outside of the domain filter, checked only syntax.&quot;</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_result</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_result</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;filtered&quot;</span><span class="p">))</span>

<div class="viewcode-block" id="UrlBase.init"><a class="viewcode-back" href="../../../code/linkcheck/linkcheck.checker.urlbase.html#linkcheck.checker.urlbase.UrlBase.init">[docs]</a>    <span class="k">def</span> <span class="nf">init</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">base_ref</span><span class="p">,</span>
        <span class="n">base_url</span><span class="p">,</span>
        <span class="n">parent_url</span><span class="p">,</span>
        <span class="n">recursion_level</span><span class="p">,</span>
        <span class="n">aggregate</span><span class="p">,</span>
        <span class="n">line</span><span class="p">,</span>
        <span class="n">column</span><span class="p">,</span>
        <span class="n">page</span><span class="p">,</span>
        <span class="n">name</span><span class="p">,</span>
        <span class="n">url_encoding</span><span class="p">,</span>
        <span class="n">extern</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize internal data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_ref</span> <span class="o">=</span> <span class="n">base_ref</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_ref</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_ref</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_ref</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_url</span> <span class="o">=</span> <span class="n">base_url</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">if</span> <span class="n">base_url</span> <span class="k">else</span> <span class="n">base_url</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_url</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_url</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_url</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent_url</span> <span class="o">=</span> <span class="n">parent_url</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_url</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent_url</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent_url</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">recursion_level</span> <span class="o">=</span> <span class="n">recursion_level</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aggregate</span> <span class="o">=</span> <span class="n">aggregate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">line</span> <span class="o">=</span> <span class="n">line</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">column</span> <span class="o">=</span> <span class="n">column</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">page</span> <span class="o">=</span> <span class="n">page</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">encoding</span> <span class="o">=</span> <span class="n">url_encoding</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extern</span> <span class="o">=</span> <span class="n">extern</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_ref</span><span class="p">:</span>
            <span class="k">assert</span> <span class="ow">not</span> <span class="n">urlutil</span><span class="o">.</span><span class="n">url_needs_quoting</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_ref</span><span class="p">),</span> <span class="p">(</span>
                <span class="s2">&quot;unquoted base reference URL </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_ref</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_url</span><span class="p">:</span>
            <span class="k">assert</span> <span class="ow">not</span> <span class="n">urlutil</span><span class="o">.</span><span class="n">url_needs_quoting</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent_url</span><span class="p">),</span> <span class="p">(</span>
                <span class="s2">&quot;unquoted parent URL </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_url</span>
            <span class="p">)</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">absolute_url</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_url</span><span class="p">,</span> <span class="n">base_ref</span><span class="p">,</span> <span class="n">parent_url</span><span class="p">)</span>
        <span class="c1"># assume file link if no scheme is found</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scheme</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">or</span> <span class="s2">&quot;file&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_url</span> <span class="o">!=</span> <span class="n">base_url</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_warning</span><span class="p">(</span>
                <span class="n">_</span><span class="p">(</span><span class="s2">&quot;Leading or trailing whitespace in URL `</span><span class="si">%(url)s</span><span class="s2">&#39;.&quot;</span><span class="p">)</span>
                <span class="o">%</span> <span class="p">{</span><span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="n">base_url</span><span class="p">},</span>
                <span class="n">tag</span><span class="o">=</span><span class="n">WARN_URL_WHITESPACE</span><span class="p">,</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="UrlBase.reset"><a class="viewcode-back" href="../../../code/linkcheck/linkcheck.checker.urlbase.html#linkcheck.checker.urlbase.UrlBase.reset">[docs]</a>    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reset all variables to default values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># self.url is constructed by self.build_url() out of base_url</span>
        <span class="c1"># and (base_ref or parent) as absolute and normed url.</span>
        <span class="c1"># This the real url we use when checking so it also referred to</span>
        <span class="c1"># as &#39;real url&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># a splitted version of url for convenience</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">urlparts</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># the scheme, host, port and anchor part of url</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scheme</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">host</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">port</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">anchor</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># the result message string and flag</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">has_result</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># valid or not</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">valid</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="c1"># list of warnings (without duplicates)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">warnings</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># list of infos</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># content size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="c1"># last modification time of content in HTTP-date format</span>
        <span class="c1"># as specified in RFC2616 chapter 3.3.1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modified</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># download time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dltime</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="c1"># check time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">checktime</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># connection object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">url_connection</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># data of url content,  (data == None) means no data is available</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># url content as a Unicode string</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># url content as a Beautiful Soup object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">soup</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># cache url is set by build_url() calling set_cache_url()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cache_url</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># extern flags (is_extern, is_strict)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extern</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># flag if the result should be cached</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">caching</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="c1"># title is either the URL or parsed from content</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># flag if content should be checked or not</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">do_check_content</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="c1"># MIME content type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">content_type</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="c1"># URLs seen through redirections</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aliases</span> <span class="o">=</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="UrlBase.set_result"><a class="viewcode-back" href="../../../code/linkcheck/linkcheck.checker.urlbase.html#linkcheck.checker.urlbase.UrlBase.set_result">[docs]</a>    <span class="k">def</span> <span class="nf">set_result</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set result string and validity.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_result</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">overwrite</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="n">LOG_CHECK</span><span class="p">,</span>
                <span class="s2">&quot;Double result </span><span class="si">%r</span><span class="s2"> (previous </span><span class="si">%r</span><span class="s2">) for </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">msg</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="p">,</span>
                <span class="bp">self</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">has_result</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">msg</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">LOG_CHECK</span><span class="p">,</span> <span class="s2">&quot;Empty result for </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="n">msg</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">valid</span> <span class="o">=</span> <span class="n">valid</span>
        <span class="c1"># free content data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="UrlBase.get_title"><a class="viewcode-back" href="../../../code/linkcheck/linkcheck.checker.urlbase.html#linkcheck.checker.urlbase.UrlBase.get_title">[docs]</a>    <span class="k">def</span> <span class="nf">get_title</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return title of page the URL refers to.</span>
<span class="sd">        This is per default the filename or the URL.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_url</span><span class="p">:</span>
                <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_url</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">:</span>
                <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">url</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">url</span>
            <span class="k">if</span> <span class="s2">&quot;/&quot;</span> <span class="ow">in</span> <span class="n">url</span><span class="p">:</span>
                <span class="n">title</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">title</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">title</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span></div>

<div class="viewcode-block" id="UrlBase.is_parseable"><a class="viewcode-back" href="../../../code/linkcheck/linkcheck.checker.urlbase.html#linkcheck.checker.urlbase.UrlBase.is_parseable">[docs]</a>    <span class="k">def</span> <span class="nf">is_parseable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return True iff content of this url is parseable.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="UrlBase.is_html"><a class="viewcode-back" href="../../../code/linkcheck/linkcheck.checker.urlbase.html#linkcheck.checker.urlbase.UrlBase.is_html">[docs]</a>    <span class="k">def</span> <span class="nf">is_html</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return True iff content of this url is HTML formatted.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_ctype</span><span class="p">(</span><span class="s2">&quot;html&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="UrlBase.is_css"><a class="viewcode-back" href="../../../code/linkcheck/linkcheck.checker.urlbase.html#linkcheck.checker.urlbase.UrlBase.is_css">[docs]</a>    <span class="k">def</span> <span class="nf">is_css</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return True iff content of this url is CSS stylesheet.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_ctype</span><span class="p">(</span><span class="s2">&quot;css&quot;</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_is_ctype</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ctype</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return True iff content is valid and of the given type.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">valid</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="n">mime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">content_type</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ContentMimetypes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">mime</span><span class="p">)</span> <span class="o">==</span> <span class="n">ctype</span>

<div class="viewcode-block" id="UrlBase.is_http"><a class="viewcode-back" href="../../../code/linkcheck/linkcheck.checker.urlbase.html#linkcheck.checker.urlbase.UrlBase.is_http">[docs]</a>    <span class="k">def</span> <span class="nf">is_http</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return True for http:// or https:// URLs.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">scheme</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;http&quot;</span><span class="p">,</span> <span class="s2">&quot;https&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="UrlBase.is_file"><a class="viewcode-back" href="../../../code/linkcheck/linkcheck.checker.urlbase.html#linkcheck.checker.urlbase.UrlBase.is_file">[docs]</a>    <span class="k">def</span> <span class="nf">is_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return True for file:// URLs.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">scheme</span> <span class="o">==</span> <span class="s2">&quot;file&quot;</span></div>

<div class="viewcode-block" id="UrlBase.is_directory"><a class="viewcode-back" href="../../../code/linkcheck/linkcheck.checker.urlbase.html#linkcheck.checker.urlbase.UrlBase.is_directory">[docs]</a>    <span class="k">def</span> <span class="nf">is_directory</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return True if current URL represents a directory.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="UrlBase.is_local"><a class="viewcode-back" href="../../../code/linkcheck/linkcheck.checker.urlbase.html#linkcheck.checker.urlbase.UrlBase.is_local">[docs]</a>    <span class="k">def</span> <span class="nf">is_local</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return True for local (ie. file://) URLs.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_file</span><span class="p">()</span></div>

<div class="viewcode-block" id="UrlBase.add_warning"><a class="viewcode-back" href="../../../code/linkcheck/linkcheck.checker.urlbase.html#linkcheck.checker.urlbase.UrlBase.add_warning">[docs]</a>    <span class="k">def</span> <span class="nf">add_warning</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a warning string.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">item</span> <span class="o">=</span> <span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">item</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">warnings</span>
            <span class="ow">and</span> <span class="n">tag</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">aggregate</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;ignorewarnings&quot;</span><span class="p">]</span>
        <span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">warnings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span></div>

<div class="viewcode-block" id="UrlBase.add_info"><a class="viewcode-back" href="../../../code/linkcheck/linkcheck.checker.urlbase.html#linkcheck.checker.urlbase.UrlBase.add_info">[docs]</a>    <span class="k">def</span> <span class="nf">add_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add an info string.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">s</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span></div>

<div class="viewcode-block" id="UrlBase.set_cache_url"><a class="viewcode-back" href="../../../code/linkcheck/linkcheck.checker.urlbase.html#linkcheck.checker.urlbase.UrlBase.set_cache_url">[docs]</a>    <span class="k">def</span> <span class="nf">set_cache_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the URL to be used for caching.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;AnchorCheck&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">aggregate</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;enabledplugins&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cache_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">url</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># remove anchor from cached target url since we assume</span>
            <span class="c1"># URLs with different anchors to have the same content</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cache_url</span> <span class="o">=</span> <span class="n">urlutil</span><span class="o">.</span><span class="n">urlunsplit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">urlparts</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">])</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">LOG_CHECK</span><span class="p">,</span> <span class="s2">&quot;cache_url &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache_url</span><span class="p">)</span></div>

<div class="viewcode-block" id="UrlBase.check_syntax"><a class="viewcode-back" href="../../../code/linkcheck/linkcheck.checker.urlbase.html#linkcheck.checker.urlbase.UrlBase.check_syntax">[docs]</a>    <span class="k">def</span> <span class="nf">check_syntax</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Called before self.check(), this function inspects the</span>
<span class="sd">        url syntax. Success enables further checking, failure</span>
<span class="sd">        immediately logs this url. Syntax checks must not</span>
<span class="sd">        use any network resources.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">LOG_CHECK</span><span class="p">,</span> <span class="s2">&quot;checking syntax&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_url</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">base_url</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_url</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_url</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_result</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;URL is empty&quot;</span><span class="p">),</span> <span class="n">valid</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">build_url</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_url_warnings</span><span class="p">()</span>
        <span class="k">except</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">ExcSyntaxList</span><span class="p">)</span> <span class="k">as</span> <span class="n">msg</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_result</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">msg</span><span class="p">),</span> <span class="n">valid</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_cache_url</span><span class="p">()</span></div>

<div class="viewcode-block" id="UrlBase.check_url_warnings"><a class="viewcode-back" href="../../../code/linkcheck/linkcheck.checker.urlbase.html#linkcheck.checker.urlbase.UrlBase.check_url_warnings">[docs]</a>    <span class="k">def</span> <span class="nf">check_url_warnings</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check URL name and length.&quot;&quot;&quot;</span>
        <span class="n">effectiveurl</span> <span class="o">=</span> <span class="n">urlutil</span><span class="o">.</span><span class="n">urlunsplit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">urlparts</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">!=</span> <span class="n">effectiveurl</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_warning</span><span class="p">(</span>
                <span class="n">_</span><span class="p">(</span><span class="s2">&quot;Effective URL </span><span class="si">%(url)r</span><span class="s2">.&quot;</span><span class="p">)</span> <span class="o">%</span> <span class="p">{</span><span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="n">effectiveurl</span><span class="p">},</span>
                <span class="n">tag</span><span class="o">=</span><span class="n">WARN_URL_EFFECTIVE_URL</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="n">effectiveurl</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">URL_MAX_LENGTH</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">scheme</span> <span class="o">!=</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">),</span> <span class="nb">max</span><span class="o">=</span><span class="n">URL_MAX_LENGTH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_warning</span><span class="p">(</span>
                <span class="n">_</span><span class="p">(</span><span class="s2">&quot;URL length </span><span class="si">%(len)d</span><span class="s2"> is longer than </span><span class="si">%(max)d</span><span class="s2">.&quot;</span><span class="p">)</span> <span class="o">%</span> <span class="n">args</span><span class="p">,</span>
                <span class="n">tag</span><span class="o">=</span><span class="n">WARN_URL_TOO_LONG</span><span class="p">,</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="UrlBase.build_url"><a class="viewcode-back" href="../../../code/linkcheck/linkcheck.checker.urlbase.html#linkcheck.checker.urlbase.UrlBase.build_url">[docs]</a>    <span class="k">def</span> <span class="nf">build_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Construct self.url and self.urlparts out of the given base</span>
<span class="sd">        url information self.base_url, self.parent_url and self.base_ref.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># norm base url - can raise UnicodeError from url.idna_encode()</span>
        <span class="n">base_url</span><span class="p">,</span> <span class="n">is_idn</span> <span class="o">=</span> <span class="n">url_norm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_url</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">)</span>
        <span class="c1"># make url absolute</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_ref</span><span class="p">:</span>
            <span class="c1"># use base reference as parent url</span>
            <span class="k">if</span> <span class="s2">&quot;:&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_ref</span><span class="p">:</span>
                <span class="c1"># some websites have a relative base reference</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">base_ref</span> <span class="o">=</span> <span class="n">urljoin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent_url</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_ref</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="n">urljoin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_ref</span><span class="p">,</span> <span class="n">base_url</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_url</span><span class="p">:</span>
            <span class="c1"># strip the parent url query and anchor</span>
            <span class="n">urlparts</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">urlsplit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent_url</span><span class="p">))</span>
            <span class="n">urlparts</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="n">parent_url</span> <span class="o">=</span> <span class="n">urlutil</span><span class="o">.</span><span class="n">urlunsplit</span><span class="p">(</span><span class="n">urlparts</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="n">urljoin</span><span class="p">(</span><span class="n">parent_url</span><span class="p">,</span> <span class="n">base_url</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="n">base_url</span>
        <span class="c1"># urljoin can unnorm the url path, so norm it again</span>
        <span class="n">urlparts</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">urlsplit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">urlparts</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
            <span class="n">urlparts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">urlutil</span><span class="o">.</span><span class="n">collapse_segments</span><span class="p">(</span><span class="n">urlparts</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">urlparts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;feed&quot;</span><span class="p">):</span>
                <span class="c1"># restore second / in http[s]:// in wayback path</span>
                <span class="n">urlparts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">url_fix_wayback_query</span><span class="p">(</span><span class="n">urlparts</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="n">urlutil</span><span class="o">.</span><span class="n">urlunsplit</span><span class="p">(</span><span class="n">urlparts</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">urlparts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_url_parts</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
        <span class="c1"># and unsplit again</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="n">urlutil</span><span class="o">.</span><span class="n">urlunsplit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">urlparts</span><span class="p">)</span></div>

<div class="viewcode-block" id="UrlBase.build_url_parts"><a class="viewcode-back" href="../../../code/linkcheck/linkcheck.checker.urlbase.html#linkcheck.checker.urlbase.UrlBase.build_url_parts">[docs]</a>    <span class="k">def</span> <span class="nf">build_url_parts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set userinfo, host, port and anchor from url and return urlparts.</span>
<span class="sd">        Also checks for obfuscated IP addresses.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">split</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">urlsplit</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="n">urlparts</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">split</span><span class="p">)</span>
        <span class="c1"># check userinfo@host:port syntax</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">userinfo</span><span class="p">,</span> <span class="n">host</span> <span class="o">=</span> <span class="n">urlutil</span><span class="o">.</span><span class="n">split_netloc</span><span class="p">(</span><span class="n">split</span><span class="o">.</span><span class="n">netloc</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">port</span> <span class="o">=</span> <span class="n">split</span><span class="o">.</span><span class="n">port</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">LinkCheckerError</span><span class="p">(</span>
                <span class="n">_</span><span class="p">(</span><span class="s2">&quot;URL host </span><span class="si">%(host)r</span><span class="s2"> has invalid port&quot;</span><span class="p">)</span> <span class="o">%</span> <span class="p">{</span><span class="s2">&quot;host&quot;</span><span class="p">:</span> <span class="n">host</span><span class="p">}</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">port</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">port</span> <span class="o">=</span> <span class="n">urlutil</span><span class="o">.</span><span class="n">default_ports</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scheme</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">port</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">LinkCheckerError</span><span class="p">(</span>
                <span class="n">_</span><span class="p">(</span><span class="s2">&quot;URL host </span><span class="si">%(host)r</span><span class="s2"> has invalid port&quot;</span><span class="p">)</span> <span class="o">%</span> <span class="p">{</span><span class="s2">&quot;host&quot;</span><span class="p">:</span> <span class="n">host</span><span class="p">}</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">port</span> <span class="o">=</span> <span class="n">port</span>
        <span class="c1"># urllib.parse.SplitResult.hostname is lowercase</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">host</span> <span class="o">=</span> <span class="n">split</span><span class="o">.</span><span class="n">hostname</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scheme</span> <span class="ow">in</span> <span class="n">scheme_requires_host</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">LinkCheckerError</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;URL has empty hostname&quot;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_obfuscated_ip</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">port</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">port</span> <span class="o">==</span> <span class="n">urlutil</span><span class="o">.</span><span class="n">default_ports</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scheme</span><span class="p">):</span>
            <span class="n">host</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">host</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">host</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">:</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">port</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">userinfo</span><span class="p">:</span>
            <span class="n">urlparts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">@</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">userinfo</span><span class="p">,</span> <span class="n">host</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">urlparts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">host</span>
        <span class="c1"># safe anchor for later checking</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">anchor</span> <span class="o">=</span> <span class="n">split</span><span class="o">.</span><span class="n">fragment</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">anchor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">anchor</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">anchor</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">urlparts</span></div>

<div class="viewcode-block" id="UrlBase.check_obfuscated_ip"><a class="viewcode-back" href="../../../code/linkcheck/linkcheck.checker.urlbase.html#linkcheck.checker.urlbase.UrlBase.check_obfuscated_ip">[docs]</a>    <span class="k">def</span> <span class="nf">check_obfuscated_ip</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Warn if host of this URL is obfuscated IP address.&quot;&quot;&quot;</span>
        <span class="c1"># check if self.host can be an IP address</span>
        <span class="c1"># check for obfuscated IP address</span>
        <span class="k">if</span> <span class="n">iputil</span><span class="o">.</span><span class="n">is_obfuscated_ip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="p">):</span>
            <span class="n">ips</span> <span class="o">=</span> <span class="n">iputil</span><span class="o">.</span><span class="n">resolve_host</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ips</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">host</span> <span class="o">=</span> <span class="n">ips</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_warning</span><span class="p">(</span>
                    <span class="n">_</span><span class="p">(</span><span class="s2">&quot;URL </span><span class="si">%(url)s</span><span class="s2"> has obfuscated IP address </span><span class="si">%(ip)s</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="o">%</span> <span class="p">{</span><span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_url</span><span class="p">,</span> <span class="s2">&quot;ip&quot;</span><span class="p">:</span> <span class="n">ips</span><span class="p">[</span><span class="mi">0</span><span class="p">]},</span>
                    <span class="n">tag</span><span class="o">=</span><span class="n">WARN_URL_OBFUSCATED_IP</span><span class="p">,</span>
                <span class="p">)</span></div>

<div class="viewcode-block" id="UrlBase.check"><a class="viewcode-back" href="../../../code/linkcheck/linkcheck.checker.urlbase.html#linkcheck.checker.urlbase.UrlBase.check">[docs]</a>    <span class="k">def</span> <span class="nf">check</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Main check function for checking this URL.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">aggregate</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;trace&quot;</span><span class="p">]:</span>
            <span class="n">trace</span><span class="o">.</span><span class="n">trace_on</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">local_check</span><span class="p">()</span>
        <span class="k">except</span> <span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">error</span><span class="p">,</span> <span class="n">select</span><span class="o">.</span><span class="n">error</span><span class="p">):</span>
            <span class="c1"># on Unix, ctrl-c can raise</span>
            <span class="c1"># error: (4, &#39;Interrupted system call&#39;)</span>
            <span class="n">etype</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[:</span><span class="mi">2</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">etype</span> <span class="o">==</span> <span class="n">errno</span><span class="o">.</span><span class="n">EINTR</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">KeyboardInterrupt</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span></div>

<div class="viewcode-block" id="UrlBase.local_check"><a class="viewcode-back" href="../../../code/linkcheck/linkcheck.checker.urlbase.html#linkcheck.checker.urlbase.UrlBase.local_check">[docs]</a>    <span class="k">def</span> <span class="nf">local_check</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Local check function can be overridden in subclasses.&quot;&quot;&quot;</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">LOG_CHECK</span><span class="p">,</span> <span class="s2">&quot;Checking </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="c1"># strict extern URLs should not be checked</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">extern</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;checking strict extern URL&#39;</span>
        <span class="c1"># check connection</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">LOG_CHECK</span><span class="p">,</span> <span class="s2">&quot;checking connection&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_connection</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_content_type</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_size_info</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">aggregate</span><span class="o">.</span><span class="n">plugin_manager</span><span class="o">.</span><span class="n">run_connection_plugins</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">except</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">ExcList</span><span class="p">)</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">handle_exception</span><span class="p">()</span>
            <span class="c1"># make nicer error msg for unknown hosts</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">exc</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">error</span><span class="p">)</span> <span class="ow">and</span> <span class="n">exc</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;Hostname not found&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">exc</span><span class="p">,</span> <span class="ne">UnicodeError</span><span class="p">):</span>
                <span class="c1"># idna.encode(host) failed</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;Bad hostname </span><span class="si">%(host)r</span><span class="s1">: </span><span class="si">%(msg)s</span><span class="s1">&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="p">{</span>
                    <span class="s1">&#39;host&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="p">,</span>
                    <span class="s1">&#39;msg&#39;</span><span class="p">:</span> <span class="n">value</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_result</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="UrlBase.check_content"><a class="viewcode-back" href="../../../code/linkcheck/linkcheck.checker.urlbase.html#linkcheck.checker.urlbase.UrlBase.check_content">[docs]</a>    <span class="k">def</span> <span class="nf">check_content</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check content of URL.</span>
<span class="sd">        @return: True if content can be parsed, else False</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_check_content</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">valid</span><span class="p">:</span>
            <span class="c1"># check content and recursion</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">can_get_content</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">aggregate</span><span class="o">.</span><span class="n">plugin_manager</span><span class="o">.</span><span class="n">run_content_plugins</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">allows_recursion</span><span class="p">():</span>
                    <span class="k">return</span> <span class="kc">True</span>
            <span class="k">except</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">ExcList</span><span class="p">):</span>
                <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">handle_exception</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_warning</span><span class="p">(</span>
                    <span class="n">_</span><span class="p">(</span><span class="s2">&quot;could not get content: </span><span class="si">%(msg)s</span><span class="s2">&quot;</span><span class="p">)</span> <span class="o">%</span> <span class="p">{</span><span class="s2">&quot;msg&quot;</span><span class="p">:</span> <span class="n">value</span><span class="p">},</span>
                    <span class="n">tag</span><span class="o">=</span><span class="n">WARN_URL_ERROR_GETTING_CONTENT</span><span class="p">,</span>
                <span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="UrlBase.close_connection"><a class="viewcode-back" href="../../../code/linkcheck/linkcheck.checker.urlbase.html#linkcheck.checker.urlbase.UrlBase.close_connection">[docs]</a>    <span class="k">def</span> <span class="nf">close_connection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Close an opened url connection.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">url_connection</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># no connection is open</span>
            <span class="k">return</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">url_connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="c1"># ignore close errors</span>
            <span class="k">pass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">url_connection</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="UrlBase.handle_exception"><a class="viewcode-back" href="../../../code/linkcheck/linkcheck.checker.urlbase.html#linkcheck.checker.urlbase.UrlBase.handle_exception">[docs]</a>    <span class="k">def</span> <span class="nf">handle_exception</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        An exception occurred. Log it and set the cache flag.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">etype</span><span class="p">,</span> <span class="n">evalue</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[:</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="n">LOG_CHECK</span><span class="p">,</span> <span class="s2">&quot;Error in </span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">,</span> <span class="n">etype</span><span class="p">,</span> <span class="n">evalue</span><span class="p">,</span> <span class="n">exception</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="c1"># note: etype must be the exact class, not a subclass</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">etype</span> <span class="ow">in</span> <span class="n">ExcNoCacheList</span><span class="p">)</span>
            <span class="ow">or</span> <span class="p">(</span><span class="n">etype</span> <span class="o">==</span> <span class="n">socket</span><span class="o">.</span><span class="n">error</span> <span class="ow">and</span> <span class="n">evalue</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">errno</span><span class="o">.</span><span class="n">EBADF</span><span class="p">)</span>
            <span class="ow">or</span> <span class="ow">not</span> <span class="n">evalue</span>
        <span class="p">):</span>
            <span class="c1"># EBADF occurs when operating on an already socket</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">caching</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># format message &quot;&lt;exception name&gt;: &lt;error message&gt;&quot;</span>
        <span class="n">errmsg</span> <span class="o">=</span> <span class="n">etype</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="k">if</span> <span class="n">evalue</span><span class="p">:</span>
            <span class="n">errmsg</span> <span class="o">+=</span> <span class="s2">&quot;: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">evalue</span>
        <span class="c1"># limit length to 240</span>
        <span class="k">return</span> <span class="n">strformat</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="n">errmsg</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">240</span><span class="p">)</span></div>

<div class="viewcode-block" id="UrlBase.check_connection"><a class="viewcode-back" href="../../../code/linkcheck/linkcheck.checker.urlbase.html#linkcheck.checker.urlbase.UrlBase.check_connection">[docs]</a>    <span class="k">def</span> <span class="nf">check_connection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The basic connection check uses urlopen to initialize</span>
<span class="sd">        a connection object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">url_connection</span> <span class="o">=</span> <span class="n">urlopen</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span></div>

<div class="viewcode-block" id="UrlBase.add_size_info"><a class="viewcode-back" href="../../../code/linkcheck/linkcheck.checker.urlbase.html#linkcheck.checker.urlbase.UrlBase.add_size_info">[docs]</a>    <span class="k">def</span> <span class="nf">add_size_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set size of URL content (if any)..</span>
<span class="sd">        Should be overridden in subclasses.&quot;&quot;&quot;</span>
        <span class="n">maxbytes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">aggregate</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;maxfilesizedownload&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="n">maxbytes</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_warning</span><span class="p">(</span>
                <span class="n">_</span><span class="p">(</span><span class="s2">&quot;Content size </span><span class="si">%(size)s</span><span class="s2"> is larger than </span><span class="si">%(maxbytes)s</span><span class="s2">.&quot;</span><span class="p">)</span>
                <span class="o">%</span> <span class="nb">dict</span><span class="p">(</span>
                    <span class="n">size</span><span class="o">=</span><span class="n">strformat</span><span class="o">.</span><span class="n">strsize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">),</span>
                    <span class="n">maxbytes</span><span class="o">=</span><span class="n">strformat</span><span class="o">.</span><span class="n">strsize</span><span class="p">(</span><span class="n">maxbytes</span><span class="p">),</span>
                <span class="p">),</span>
                <span class="n">tag</span><span class="o">=</span><span class="n">WARN_URL_CONTENT_SIZE_TOO_LARGE</span><span class="p">,</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="UrlBase.allows_simple_recursion"><a class="viewcode-back" href="../../../code/linkcheck/linkcheck.checker.urlbase.html#linkcheck.checker.urlbase.UrlBase.allows_simple_recursion">[docs]</a>    <span class="k">def</span> <span class="nf">allows_simple_recursion</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check recursion level and extern status.&quot;&quot;&quot;</span>
        <span class="n">rec_level</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">aggregate</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;recursionlevel&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">rec_level</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">recursion_level</span> <span class="o">&gt;=</span> <span class="n">rec_level</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">LOG_CHECK</span><span class="p">,</span> <span class="s2">&quot;... no, maximum recursion level reached.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">extern</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">LOG_CHECK</span><span class="p">,</span> <span class="s2">&quot;... no, extern.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="UrlBase.allows_recursion"><a class="viewcode-back" href="../../../code/linkcheck/linkcheck.checker.urlbase.html#linkcheck.checker.urlbase.UrlBase.allows_recursion">[docs]</a>    <span class="k">def</span> <span class="nf">allows_recursion</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return True iff we can recurse into the url&#39;s content.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">LOG_CHECK</span><span class="p">,</span> <span class="s2">&quot;checking recursion of </span><span class="si">%r</span><span class="s2"> ...&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">valid</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">LOG_CHECK</span><span class="p">,</span> <span class="s2">&quot;... no, invalid.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">can_get_content</span><span class="p">():</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">LOG_CHECK</span><span class="p">,</span> <span class="s2">&quot;... no, cannot get content.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">allows_simple_recursion</span><span class="p">():</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">aggregate</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;maxfilesizeparse&quot;</span><span class="p">]:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">LOG_CHECK</span><span class="p">,</span> <span class="s2">&quot;... no, maximum parse size.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_parseable</span><span class="p">():</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">LOG_CHECK</span><span class="p">,</span> <span class="s2">&quot;... no, not parseable.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">content_allows_robots</span><span class="p">():</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">LOG_CHECK</span><span class="p">,</span> <span class="s2">&quot;... no, robots.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">LOG_CHECK</span><span class="p">,</span> <span class="s2">&quot;... yes, recursion.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="UrlBase.content_allows_robots"><a class="viewcode-back" href="../../../code/linkcheck/linkcheck.checker.urlbase.html#linkcheck.checker.urlbase.UrlBase.content_allows_robots">[docs]</a>    <span class="k">def</span> <span class="nf">content_allows_robots</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns True: only check robots.txt on HTTP links.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="UrlBase.set_extern"><a class="viewcode-back" href="../../../code/linkcheck/linkcheck.checker.urlbase.html#linkcheck.checker.urlbase.UrlBase.set_extern">[docs]</a>    <span class="k">def</span> <span class="nf">set_extern</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Match URL against extern and intern link patterns. If no pattern</span>
<span class="sd">        matches the URL is extern. Sets self.extern to a tuple (bool,</span>
<span class="sd">        bool) with content (is_extern, is_strict).</span>

<span class="sd">        @return: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">extern</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">url</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">extern</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">aggregate</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;externlinks&quot;</span><span class="p">]:</span>
            <span class="n">match</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="s1">&#39;pattern&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">entry</span><span class="p">[</span><span class="s1">&#39;negate&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">match</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">match</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">entry</span><span class="p">[</span><span class="s1">&#39;negate&#39;</span><span class="p">]):</span>
                <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">LOG_CHECK</span><span class="p">,</span> <span class="s2">&quot;Extern URL </span><span class="si">%r</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">extern</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">entry</span><span class="p">[</span><span class="s1">&#39;strict&#39;</span><span class="p">])</span>
                <span class="k">return</span>
        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">aggregate</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;internlinks&quot;</span><span class="p">]:</span>
            <span class="n">match</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="s1">&#39;pattern&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">entry</span><span class="p">[</span><span class="s1">&#39;negate&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">match</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">match</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">entry</span><span class="p">[</span><span class="s1">&#39;negate&#39;</span><span class="p">]):</span>
                <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">LOG_CHECK</span><span class="p">,</span> <span class="s2">&quot;Intern URL </span><span class="si">%r</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">extern</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="k">return</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">aggregate</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;checkextern&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">extern</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">extern</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span></div>

<div class="viewcode-block" id="UrlBase.set_content_type"><a class="viewcode-back" href="../../../code/linkcheck/linkcheck.checker.urlbase.html#linkcheck.checker.urlbase.UrlBase.set_content_type">[docs]</a>    <span class="k">def</span> <span class="nf">set_content_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set content MIME type.</span>
<span class="sd">        Should be overridden in subclasses.&quot;&quot;&quot;</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="UrlBase.can_get_content"><a class="viewcode-back" href="../../../code/linkcheck/linkcheck.checker.urlbase.html#linkcheck.checker.urlbase.UrlBase.can_get_content">[docs]</a>    <span class="k">def</span> <span class="nf">can_get_content</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Indicate wether url get_content() can be called.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">aggregate</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;maxfilesizedownload&quot;</span><span class="p">]</span></div>

<div class="viewcode-block" id="UrlBase.download_content"><a class="viewcode-back" href="../../../code/linkcheck/linkcheck.checker.urlbase.html#linkcheck.checker.urlbase.UrlBase.download_content">[docs]</a>    <span class="k">def</span> <span class="nf">download_content</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">LOG_CHECK</span><span class="p">,</span> <span class="s2">&quot;Get content of </span><span class="si">%r</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">content</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_content</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dltime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_warning</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Content size is zero.&quot;</span><span class="p">),</span> <span class="n">tag</span><span class="o">=</span><span class="n">WARN_URL_CONTENT_SIZE_ZERO</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">aggregate</span><span class="o">.</span><span class="n">add_downloaded_bytes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">content</span></div>

<div class="viewcode-block" id="UrlBase.get_soup"><a class="viewcode-back" href="../../../code/linkcheck/linkcheck.checker.urlbase.html#linkcheck.checker.urlbase.UrlBase.get_soup">[docs]</a>    <span class="k">def</span> <span class="nf">get_soup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">soup</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_content</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">soup</span></div>

<div class="viewcode-block" id="UrlBase.get_raw_content"><a class="viewcode-back" href="../../../code/linkcheck/linkcheck.checker.urlbase.html#linkcheck.checker.urlbase.UrlBase.get_raw_content">[docs]</a>    <span class="k">def</span> <span class="nf">get_raw_content</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">download_content</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span></div>

<div class="viewcode-block" id="UrlBase.get_content"><a class="viewcode-back" href="../../../code/linkcheck/linkcheck.checker.urlbase.html#linkcheck.checker.urlbase.UrlBase.get_content">[docs]</a>    <span class="k">def</span> <span class="nf">get_content</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_raw_content</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">soup</span> <span class="o">=</span> <span class="n">htmlsoup</span><span class="o">.</span><span class="n">make_soup</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">encoding</span><span class="p">)</span>
            <span class="c1"># Sometimes soup.original_encoding is None!  Better mangled text</span>
            <span class="c1"># than an internal crash, eh?  ISO-8859-1 is a safe fallback in the</span>
            <span class="c1"># sense that any binary blob can be decoded, it&#39;ll never cause a</span>
            <span class="c1"># UnicodeDecodeError.</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="n">LOG_CHECK</span><span class="p">,</span> <span class="s2">&quot;Beautiful Soup detected </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">soup</span><span class="o">.</span><span class="n">original_encoding</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">encoding</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">soup</span><span class="o">.</span><span class="n">original_encoding</span> <span class="ow">or</span> <span class="s1">&#39;ISO-8859-1&#39;</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">LOG_CHECK</span><span class="p">,</span> <span class="s2">&quot;Content encoding </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span></div>

<div class="viewcode-block" id="UrlBase.read_content"><a class="viewcode-back" href="../../../code/linkcheck/linkcheck.checker.urlbase.html#linkcheck.checker.urlbase.UrlBase.read_content">[docs]</a>    <span class="k">def</span> <span class="nf">read_content</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return data for this URL. Can be overridden in subclasses.&quot;&quot;&quot;</span>
        <span class="n">buf</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">()</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_content_chunk</span><span class="p">()</span>
        <span class="k">while</span> <span class="n">data</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">buf</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">aggregate</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;maxfilesizedownload&quot;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="n">LinkCheckerError</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;File size too large&quot;</span><span class="p">))</span>
            <span class="n">buf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_content_chunk</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">buf</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span></div>

<div class="viewcode-block" id="UrlBase.read_content_chunk"><a class="viewcode-back" href="../../../code/linkcheck/linkcheck.checker.urlbase.html#linkcheck.checker.urlbase.UrlBase.read_content_chunk">[docs]</a>    <span class="k">def</span> <span class="nf">read_content_chunk</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Read one chunk of content from this URL.</span>
<span class="sd">        Precondition: url_connection is an opened URL.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">url_connection</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ReadChunkBytes</span><span class="p">)</span></div>

<div class="viewcode-block" id="UrlBase.get_user_password"><a class="viewcode-back" href="../../../code/linkcheck/linkcheck.checker.urlbase.html#linkcheck.checker.urlbase.UrlBase.get_user_password">[docs]</a>    <span class="k">def</span> <span class="nf">get_user_password</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get tuple (user, password) from configured authentication.</span>
<span class="sd">        Both user and password can be None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">userinfo</span><span class="p">:</span>
            <span class="c1"># URL itself has authentication info</span>
            <span class="n">split</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">urlsplit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">split</span><span class="o">.</span><span class="n">username</span><span class="p">,</span> <span class="n">split</span><span class="o">.</span><span class="n">password</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">aggregate</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get_user_password</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span></div>

<div class="viewcode-block" id="UrlBase.add_url"><a class="viewcode-back" href="../../../code/linkcheck/linkcheck.checker.urlbase.html#linkcheck.checker.urlbase.UrlBase.add_url">[docs]</a>    <span class="k">def</span> <span class="nf">add_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">line</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">page</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add new URL to queue.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">base</span><span class="p">:</span>
            <span class="n">base_ref</span> <span class="o">=</span> <span class="n">urlutil</span><span class="o">.</span><span class="n">url_norm</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">base_ref</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">url_data</span> <span class="o">=</span> <span class="n">get_url_from</span><span class="p">(</span>
            <span class="n">url</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">recursion_level</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">aggregate</span><span class="p">,</span>
            <span class="n">parent_url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">,</span>
            <span class="n">base_ref</span><span class="o">=</span><span class="n">base_ref</span><span class="p">,</span>
            <span class="n">line</span><span class="o">=</span><span class="n">line</span><span class="p">,</span>
            <span class="n">column</span><span class="o">=</span><span class="n">column</span><span class="p">,</span>
            <span class="n">page</span><span class="o">=</span><span class="n">page</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
            <span class="n">parent_content_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">content_type</span><span class="p">,</span>
            <span class="n">url_encoding</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aggregate</span><span class="o">.</span><span class="n">urlqueue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">url_data</span><span class="p">)</span></div>

<div class="viewcode-block" id="UrlBase.serialized"><a class="viewcode-back" href="../../../code/linkcheck/linkcheck.checker.urlbase.html#linkcheck.checker.urlbase.UrlBase.serialized">[docs]</a>    <span class="k">def</span> <span class="nf">serialized</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return serialized url check data as unicode string.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> link&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">scheme</span><span class="p">,</span>
                <span class="s2">&quot;base_url=</span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_url</span><span class="p">,</span>
                <span class="s2">&quot;parent_url=</span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_url</span><span class="p">,</span>
                <span class="s2">&quot;base_ref=</span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_ref</span><span class="p">,</span>
                <span class="s2">&quot;recursion_level=</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">recursion_level</span><span class="p">,</span>
                <span class="s2">&quot;url_connection=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">url_connection</span><span class="p">,</span>
                <span class="s2">&quot;line=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">line</span><span class="p">,</span>
                <span class="s2">&quot;column=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">column</span><span class="p">,</span>
                <span class="s2">&quot;page=</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">page</span><span class="p">,</span>
                <span class="s2">&quot;name=</span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="s2">&quot;anchor=</span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">anchor</span><span class="p">,</span>
                <span class="s2">&quot;cache_url=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache_url</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="UrlBase.get_intern_pattern"><a class="viewcode-back" href="../../../code/linkcheck/linkcheck.checker.urlbase.html#linkcheck.checker.urlbase.UrlBase.get_intern_pattern">[docs]</a>    <span class="k">def</span> <span class="nf">get_intern_pattern</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get pattern for intern URL matching.</span>

<span class="sd">        @param url: the URL to set intern pattern for, else self.url</span>
<span class="sd">        @type url: unicode or None</span>
<span class="sd">        @return: non-empty regex pattern or None</span>
<span class="sd">        @rtype: String or None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="UrlBase.add_intern_pattern"><a class="viewcode-back" href="../../../code/linkcheck/linkcheck.checker.urlbase.html#linkcheck.checker.urlbase.UrlBase.add_intern_pattern">[docs]</a>    <span class="k">def</span> <span class="nf">add_intern_pattern</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add intern URL regex to config.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">pat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_intern_pattern</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">pat</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">LOG_CHECK</span><span class="p">,</span> <span class="s2">&quot;Add intern pattern </span><span class="si">%r</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">pat</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">aggregate</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;internlinks&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get_link_pat</span><span class="p">(</span><span class="n">pat</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">UnicodeError</span> <span class="k">as</span> <span class="n">msg</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;URL has unparsable domain name: </span><span class="si">%(domain)s</span><span class="s2">&quot;</span><span class="p">)</span> <span class="o">%</span> <span class="p">{</span><span class="s2">&quot;domain&quot;</span><span class="p">:</span> <span class="n">msg</span><span class="p">}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_result</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get URL info.</span>

<span class="sd">        @return: URL info</span>
<span class="sd">        @rtype: unicode</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">serialized</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__bytes__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get URL info.</span>

<span class="sd">        @return: URL info, encoded with the output logger encoding</span>
<span class="sd">        @rtype: string</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">s</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">aggregate</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;logger&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get URL info.</span>

<span class="sd">        @return: URL info</span>
<span class="sd">        @rtype: unicode</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;&lt;</span><span class="si">%s</span><span class="s2">&gt;&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">serialized</span><span class="p">(</span><span class="n">sep</span><span class="o">=</span><span class="s2">&quot;, &quot;</span><span class="p">)</span>

<div class="viewcode-block" id="UrlBase.to_wire_dict"><a class="viewcode-back" href="../../../code/linkcheck/linkcheck.checker.urlbase.html#linkcheck.checker.urlbase.UrlBase.to_wire_dict">[docs]</a>    <span class="k">def</span> <span class="nf">to_wire_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a simplified transport object for logging and caching.</span>

<span class="sd">        The transport object must contain these attributes:</span>

<span class="sd">        - url_data.valid: bool</span>
<span class="sd">          Indicates if URL is valid</span>
<span class="sd">        - url_data.result: unicode</span>
<span class="sd">          Result string</span>
<span class="sd">        - url_data.warnings: list of tuples (tag, warning message)</span>
<span class="sd">          List of tagged warnings for this URL.</span>
<span class="sd">        - url_data.name: unicode string or None</span>
<span class="sd">          name of URL (eg. filename or link name)</span>
<span class="sd">        - url_data.parent_url: unicode or None</span>
<span class="sd">          Parent URL</span>
<span class="sd">        - url_data.base_ref: unicode</span>
<span class="sd">          HTML base reference URL of parent</span>
<span class="sd">        - url_data.url: unicode</span>
<span class="sd">          Fully qualified URL.</span>
<span class="sd">        - url_data.domain: unicode</span>
<span class="sd">          URL domain part.</span>
<span class="sd">        - url_data.checktime: int</span>
<span class="sd">          Number of seconds needed to check this link, default: zero.</span>
<span class="sd">        - url_data.dltime: int</span>
<span class="sd">          Number of seconds needed to download URL content, default: -1</span>
<span class="sd">        - url_data.size: int</span>
<span class="sd">          Size of downloaded URL content, default: -1</span>
<span class="sd">        - url_data.info: list of unicode</span>
<span class="sd">          Additional information about this URL.</span>
<span class="sd">        - url_data.line: int</span>
<span class="sd">          Line number of this URL at parent document, or None</span>
<span class="sd">        - url_data.column: int</span>
<span class="sd">          Column number of this URL at parent document, or None</span>
<span class="sd">        - url_data.page: int</span>
<span class="sd">          Page number of this URL at parent document, or -1</span>
<span class="sd">        - url_data.cache_url: unicode</span>
<span class="sd">          Cache url for this URL.</span>
<span class="sd">        - url_data.content_type: unicode</span>
<span class="sd">          MIME content type for URL content.</span>
<span class="sd">        - url_data.level: int</span>
<span class="sd">          Recursion level until reaching this URL from start URL</span>
<span class="sd">        - url_data.last_modified: datetime</span>
<span class="sd">          Last modification date of retrieved page (or None).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">valid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">valid</span><span class="p">,</span>
            <span class="n">extern</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">extern</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">result</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="p">,</span>
            <span class="n">warnings</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">warnings</span><span class="p">[:],</span>
            <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="n">title</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_title</span><span class="p">(),</span>
            <span class="n">parent_url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parent_url</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="n">base_ref</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">base_ref</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="n">base_url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">base_url</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="n">url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="n">domain</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">urlparts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">urlparts</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
            <span class="n">checktime</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">checktime</span><span class="p">,</span>
            <span class="n">dltime</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dltime</span><span class="p">,</span>
            <span class="n">size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">,</span>
            <span class="n">info</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">,</span>
            <span class="n">line</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">line</span><span class="p">,</span>
            <span class="n">column</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">column</span><span class="p">,</span>
            <span class="n">page</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">page</span><span class="p">,</span>
            <span class="n">cache_url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cache_url</span><span class="p">,</span>
            <span class="n">content_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">content_type</span><span class="p">,</span>
            <span class="n">level</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">recursion_level</span><span class="p">,</span>
            <span class="n">modified</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">modified</span><span class="p">,</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="UrlBase.to_wire"><a class="viewcode-back" href="../../../code/linkcheck/linkcheck.checker.urlbase.html#linkcheck.checker.urlbase.UrlBase.to_wire">[docs]</a>    <span class="k">def</span> <span class="nf">to_wire</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return compact UrlData object with information from to_wire_dict().</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">CompactUrlData</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">to_wire_dict</span><span class="p">())</span></div></div>


<span class="n">urlDataAttr</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;valid&#39;</span><span class="p">,</span>
    <span class="s1">&#39;extern&#39;</span><span class="p">,</span>
    <span class="s1">&#39;result&#39;</span><span class="p">,</span>
    <span class="s1">&#39;warnings&#39;</span><span class="p">,</span>
    <span class="s1">&#39;name&#39;</span><span class="p">,</span>
    <span class="s1">&#39;title&#39;</span><span class="p">,</span>
    <span class="s1">&#39;parent_url&#39;</span><span class="p">,</span>
    <span class="s1">&#39;base_ref&#39;</span><span class="p">,</span>
    <span class="s1">&#39;base_url&#39;</span><span class="p">,</span>
    <span class="s1">&#39;url&#39;</span><span class="p">,</span>
    <span class="s1">&#39;domain&#39;</span><span class="p">,</span>
    <span class="s1">&#39;checktime&#39;</span><span class="p">,</span>
    <span class="s1">&#39;dltime&#39;</span><span class="p">,</span>
    <span class="s1">&#39;size&#39;</span><span class="p">,</span>
    <span class="s1">&#39;info&#39;</span><span class="p">,</span>
    <span class="s1">&#39;modified&#39;</span><span class="p">,</span>
    <span class="s1">&#39;line&#39;</span><span class="p">,</span>
    <span class="s1">&#39;column&#39;</span><span class="p">,</span>
    <span class="s1">&#39;page&#39;</span><span class="p">,</span>
    <span class="s1">&#39;cache_url&#39;</span><span class="p">,</span>
    <span class="s1">&#39;content_type&#39;</span><span class="p">,</span>
    <span class="s1">&#39;level&#39;</span><span class="p">,</span>
<span class="p">]</span>


<div class="viewcode-block" id="CompactUrlData"><a class="viewcode-back" href="../../../code/linkcheck/linkcheck.checker.urlbase.html#linkcheck.checker.urlbase.CompactUrlData">[docs]</a><span class="k">class</span> <span class="nc">CompactUrlData</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Store selected UrlData attributes in slots to minimize memory usage.&quot;&quot;&quot;</span>

    <span class="vm">__slots__</span> <span class="o">=</span> <span class="n">urlDataAttr</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wired_url_data</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Set all attributes according to the dictionnary wired_url_data&#39;&#39;&#39;</span>
        <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">urlDataAttr</span><span class="p">:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">wired_url_data</span><span class="p">[</span><span class="n">attr</span><span class="p">])</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2000-2016 Bastian Kleineidam, 2010-2021 LinkChecker Authors.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>